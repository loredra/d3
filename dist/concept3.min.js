/*! concept3 01-06-2016 */
function reCalculateLayoutWhenResize(){0==IsExpanded&&(width=d3.select("#associate_info").node().getBoundingClientRect().width/2,height=d3.select("#associate_info").node().getBoundingClientRect().height,svg.attr("width",width).attr("height",height))}function expandForceLayout(){0==IsExpanded?(d3.select("#associate_info_node").style("display","none"),width=d3.select("#associate_info").node().getBoundingClientRect().width,height=d3.select("#associate_info").node().getBoundingClientRect().height,svg.attr("width",width).attr("height",height),d3.select("#visualization").style("width","100%").style("max-width","100%"),d3.select("#trustScore").attr("transform","translate(1290,-14)"),d3.select("#expand_forcelayout").text(">>>"),IsExpanded=!0):collapseForceLayout()}function collapseForceLayout(){d3.select("#associate_info_node").style("display",null),width=d3.select("#associate_info").node().getBoundingClientRect().width/2,height=d3.select("#associate_info").node().getBoundingClientRect().height,svg.attr("width",width).attr("height",height),d3.select("#visualization").style("width","50%").style("max-width","50%"),d3.select("#trustScore").attr("transform","translate(570,-14)"),d3.select("#expand_forcelayout").text("<<<"),IsExpanded=!1}function linkToolTip(a){var b=a.attr("type");tooltip.text(b),tooltip.style("visibility","visible")}function zoomed(){container.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function dragstarted(a){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0)}function dragged(a){root=a,root.fixed=!0,d3.select(this).attr("x",a.x=d3.event.x).attr("y",a.y=d3.event.y)}function dragended(a){d3.select(this).classed("dragging",!1)}function translateBeforeChose(a,b){var c=width/2-a*zoom.scale(),d=height/2-b*zoom.scale();zoom.translate([c,d]),container.transition().duration(750).attr("transform","translate("+c+","+d+")scale("+zoom.scale()+")")}function trust_to_color(a,b){try{if("Inactive"==b)return"grey"}catch(c){}return a>=80?"green":a>=30&&79>=a?"yellow":30>=a?"red":void 0}function clickImage(a){if(!d3.event.defaultPrevented){d3.selectAll(".node").attr("isChosen","no").select(".node_image").transition().attr("x",-12).attr("y",-12).attr("width","24px").attr("height","24px"),vis=d3.selectAll(".highlight_circle"),vis.attr("transform","scale(0.1,0.1)").attr("opacity",0),translateBeforeChose(a.x,a.y),d3.select(this).attr("isChosen","yes").select(".node_image").transition().duration(750).attr("x",-20).attr("y",-20).attr("width","40px").attr("height","40px").style("fill","lightsteelblue"),d3.select(this).select(".highlight_circle").transition().duration(450).attr("transform","scale(1,1)").attr("opacity",.9);var b=d3.select("#list").selectAll("li").filter(function(b){return a.id==b.id});d3.select("#list").property("scrollTop",19*b.attr("id").toString().replace("index","")).selectAll("li").style("background",function(b){return a.id==b.id?"#ffa366":"#cce5ff"}),populateDetailPage(a)}}function showAdvancedSearch(){isFirstAdvancedSearchOpen&&(advanced_search=d3.select("#main_layout").insert("div",":first-child"),advanced_search.attr("class","advanced_search_collapsible"),black_list_filter=advanced_search.append("div").attr("class","filter").attr("id","black_list_filter"),black_list_filter.append("span").attr("class","filter_label").text("Black List"),black_list_filter.append("div").attr("class","criteria_container").append("div").attr("class","criteria").text("This is a 65 characters long and it is the same as average list name"),sanction_filter=advanced_search.append("div").attr("class","filter").attr("id","sanction_filter"),sanction_filter.append("span").attr("class","filter_label").text("Sanction List"),sanction_filter.append("div").attr("class","criteria_container"),sanction_filter.select(".criteria_container").selectAll("div").data(dummyData).enter().append("div").attr("class","criteria").text(function(a){return"#"+a.name}),country_filter=advanced_search.append("div").attr("class","filter").attr("id","country_filter"),country_filter.append("span").attr("class","filter_label").text("Country"),city_filter=advanced_search.append("div").attr("class","filter").attr("id","city_filter"),city_filter.append("span").attr("class","filter_label").text("City"),isFirstAdvancedSearchOpen=!1),isAdvancedSearchClose?(d3.select(".advanced_search_collapsible").style("display",""),isAdvancedSearchClose=!1):(d3.select(".advanced_search_collapsible").style("display","none"),isAdvancedSearchClose=!0)}function mouseOverList(a){try{tooltip=d3.select(".tooltip"),tooltip.style("visibility","visible"),tooltip.html("Expiration Date: "+a)}catch(b){tooltip.style("visibility","hidden")}}function mouseout(a){tooltip.style("visibility","hidden")}function mousemove(a){tooltip.style("top",d3.event.pageY+16+"px").style("left",d3.event.pageX+16+"px")}function populateDetailPage(a){d3.selectAll(".detail_name").remove(),d3.selectAll(".detail_address").remove(),d3.selectAll(".ul_list_List").remove(),d3.selectAll(".measure_icon").remove();var b,c="",d=null;try{d=a.AllMeasures}catch(e){d=["arms"]}detail.select("#name").append("div").text(a.name).attr("class","detail_name").attr("position","relative"),detail.select("#address").append("div").text(a.address).attr("class","detail_address").attr("position","relative");try{detail.select(".measure").selectAll(".measure_icon").data(d).enter().append("img").attr("class","measure_icon").attr("src",function(a){return"resources/"+a+".svg"})}catch(f){}try{listList1=a.isListedIn;for(i in listList1)c=c.concat(listList1[i].Name,",");c=c.slice(0,-1),c=c.split(","),b=""==c?0:c.length}catch(f){b=0}d3.select("#numOfList").text(b);try{var g=a.AKA;numOfAKA=g.length}catch(f){numOfAKA=0}d3.select("#numOfName").text(numOfAKA);try{var h=a.KnownAddress;numOfAddress=h.length}catch(f){numOfAddress=0}d3.select("#numOfAddress").text(numOfAddress);d3.select("#listList").append("ul").attr("class","ul_list_List").selectAll("li").data(a.isListedIn).enter().append("li").attr("class","listList").style("font-size","15px").text(function(a){return a.Name}).style("text-anchor","start").on("click",overlay).on("mouseover",function(a){void 0!=a.Expiration&&mouseOverList(a.Expiration)}).on("mousemove",mousemove).on("mouseout",mouseout),d3.select("#listAKA").append("ul").attr("class","ul_list_List").selectAll("li").data(g).enter().append("li").attr("class","listAKA").style("font-size","15px").text(function(a){return a}).style("text-anchor","start"),d3.select("#listKA").append("ul").attr("class","ul_list_List").selectAll("li").data(h).enter().append("li").attr("class","listKA").style("font-size","15px").text(function(a){return a}).style("text-anchor","start")}function overlay(){el=d3.select("#overlay"),el.style("visibility","visible"==el.style("visibility")?"hidden":"visible"),el.select(".close").on("click",closeOverlay)}function closeOverlay(){el=d3.select("#overlay"),d3.select(".close").on("click",el.style("visibility","hidden"))}function click(a){vis=d3.selectAll(".highlight_circle"),vis.attr("transform","scale(0.1,0.1)").attr("opacity",0),d3.selectAll(".node").select(".node_image").transition().duration(750).attr("x",-12).attr("y",-12).attr("width","24px").attr("height","24px");var b=d3.selectAll(".node").filter(function(b){return b.id==a.id});b.attr("isChosen","yes").select(".node_image").transition().duration(750).attr("x",-20).attr("y",-20).attr("width","40px").attr("height","40px"),b.select(".highlight_circle").transition().duration(450).attr("transform","scale(1,1)").attr("opacity",.7),translateBeforeChose(b.datum().x,b.datum().y),d3.selectAll("li").style("background","#cce5ff"),firstLoad?(d3.select("#list").select("li").style("background","#ffa366"),firstLoad=!1):d3.select(this).style("background","#ffa366"),populateDetailPage(b.datum())}module.exports=function(a){a.initConfig({pkg:a.file.readJSON("package.json"),concat:{options:{separator:";"},dist:{src:["*.js"],dest:"dist/<%= pkg.name %>.js"}},uglify:{options:{banner:'/*! <%= pkg.name %> <%= grunt.template.today("dd-mm-yyyy") %> */\n'},dist:{files:{"dist/<%= pkg.name %>.min.js":["<%= concat.dist.dest %>"]}}}}),a.loadNpmTasks("grunt-contrib-uglify"),a.loadNpmTasks("grunt-contrib-concat"),a.registerTask("default",["concat","uglify"])};var width=d3.select("#associate_info").node().getBoundingClientRect().width/2,height=d3.select("#associate_info").node().getBoundingClientRect().height,IsExpanded=!1,margin={top:-1,right:-1,bottom:-1,left:-1},isChosen=0,force=d3.layout.force().charge(-7700).linkDistance(70).size([width,height]),drag=force.drag().origin(function(a){return a}).on("dragstart",dragstarted).on("drag",dragged).on("dragend",dragended),zoom=d3.behavior.zoom().scaleExtent([.4,6]).on("zoom",zoomed),svg=d3.select("body").select("#associate_info").select("#visualization").append("svg").attr("class","svg").attr("width",width).attr("height",height).call(zoom).on("dblclick.zoom",null),container=svg.append("g");d3.json("pst2.json",function(a,b){function c(a){o.style("font-weight","normal"),m.style("stroke","#999"),tooltip.style("visibility","hidden")}function d(a){tooltip.style("top",d3.event.pageY+16+"px").style("left",d3.event.pageX+16+"px")}function e(a){o.style("font-weight",function(b){return g(a,b)?"bold":"normal"}),m.style("stroke",function(b){return b.source.index==a.index||b.target.index==a.index?"red":"#999"});try{statusColor="red",tooltip.style("visibility","visible"),tooltip.html(a.name+"<br>Type: "+a.type+"<br>Status: <span style='color: "+statusColor+"'>"+a.status+"</span><br>Listed in "+a.isListedIn.length+" Sanction Lists")}catch(b){tooltip.style("visibility","visible"),tooltip.html(a.name)}}function f(){0==d3.select("#node_check_box").property("checked")?isDisplay="initial":isDisplay="none",d3.selectAll(".text_svg").style("display",isDisplay),0==d3.select("#link_check_box").property("checked")?isDisplay="initial":isDisplay="none",d3.selectAll(".text_link_svg").style("display",isDisplay)}function g(a,b){return j[a.index+","+b.index]||j[b.index+","+a.index]||a.index==b.index}function h(a){root.fixed=!1}function i(){force.on("tick",function(){p.attr("x",function(a){return(a.source.x+a.target.x)/2+3}).attr("y",function(a){return(a.source.y+a.target.y)/2}),m.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),n.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),o.attr("x",function(a){return a.x}).attr("y",function(a){return a.y+38})})}if(a)throw a;root=b.nodes[0],root.x=width/2,root.y=height/2,root.fixed=!0,b.links.forEach(function(a,c){a.source=isNaN(a.source)?a.source:b.nodes[a.source],a.target=isNaN(a.target)?a.target:b.nodes[a.target]}),tooltip=d3.select(".tooltip");var j={};b.links.forEach(function(a){j[a.source+","+a.target]=!0});var k=d3.scale.linear().domain([0,100]).range([0,2*Math.PI]),l=d3.svg.arc().innerRadius(43).outerRadius(46).startAngle(k(0)).endAngle(k(100));container.attr("transform","translate(0,0)scale(1)");var m=container.append("g").selectAll(".link").data(b.links).enter().append("line").attr("class","link").attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).attr("type",function(a){return a.linktype}).on("mouseover",function(a){linkToolTip(d3.select(this))}).on("mouseout",function(a){tooltip.style("visibility","hidden")}).on("mousemove",d).style("stroke-width",function(a){return 6}).style("marker-end","url(#resolved)"),n=(container.append("g").selectAll("marker").data(["suit","licensing","resolved"]).enter().append("marker").attr("id",function(a){return a}).attr("viewBox","0 -5 10 10").attr("refX",25).attr("refY",0).attr("markerWidth",2).attr("markerHeight",2).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").style("stroke","#4679BD").style("opacity","0.6"),container.append("g").selectAll(".node").data(b.nodes).enter().append("g").attr("id",function(a){return a.id}).attr("class","node").attr("name",function(a){return a.name}).attr("address",function(a){return a.address}).attr("isListedIn",function(a){return null!=a.isListedIn?a.isListedIn:""}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("width",function(a){return"24px"}).attr("height",function(a){return"24px"}).attr("isChosen","no").attr("name",function(a){return a.name}).call(force.drag).on("mouseover",e).on("mousemove",d).on("mouseout",c).on("click",clickImage).on("dblclick.zoom",null).on("dblclick",h)),o=(n.append("circle").attr("r",26).style("fill",function(a){return trust_to_color(a.trust,a.status)}),n.append("image").attr("class","node_image").attr("xlink:href",function(a){return"resources/"+a.type+".svg"}).attr("x",-12).attr("y",-12).attr("width",function(a){return"24px"}).attr("height",function(a){return"24px"}),n.append("path").attr("transform",function(a){return"scale(0.1,0.1)"}).attr("class","highlight_circle").attr("d",l).attr("opacity",0),container.append("g").selectAll(".text").data(b.nodes).enter().append("text").attr("class","text_svg").attr("dy",".35em").style("font-size","13px"));o.text(function(a){return a.name}).style("text-anchor","middle"),force.nodes(b.nodes).links(b.links).start();var p=container.append("g").selectAll(".text_link_svg").data(force.links()).enter().append("text").text(function(a){return a.linktype}).attr("class","text_link_svg").attr("dy",".35em").style("text-anchor","middle").style("font-size","10px");f();var q=d3.select(".svg").append("g").attr("id","trustScore").attr("transform","translate(570,-14)");q.append("rect").attr("width",60*b.level_trust.length).attr("height",27*b.level_trust.length).style("fill","#eaf0fa");var r=q.selectAll().data(b.level_trust).enter();r.append("text").attr("transform",function(a,b){return"translate(22,"+25*(b+1)+")"}).text(function(a){return a.Message}).style("fill","black").style("dominant-baseline","central"),r.append("circle").attr("r",10).attr("transform",function(a,b){return"translate(10,"+25*(b+1)+")"}).style("fill",function(a){return a.color}),d3.select("#node_check_box").on("change",f),d3.select("#link_check_box").on("change",f),i()});var detail=d3.select("#detail_info"),firstLoad=!0,isAdvancedSearchClose=!0,isFirstAdvancedSearchOpen=!0;tooltip=d3.select(".tooltip"),dummyData=[{name:"USSDN"},{name:"Long Long Long Long one"},{name:"Short"},{name:"CSFDSFSS"}],d3.json("pst2.json",function(a,b){if(a)throw a;d3.select("#list").append("ul").selectAll("li").data(b.nodes).enter().append("li").attr("id",function(a,b){return"index"+b}).style("font-size","15px").text(function(a){return a.name}).style("text-anchor","start").on("click",click);click(d3.select("#list").select("li").datum())});